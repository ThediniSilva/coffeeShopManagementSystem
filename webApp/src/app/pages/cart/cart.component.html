<div class="background position-relative">
    <div class="container my-5">
      <div class="d-flex justify-content-center align-items-center mb-5">
        <!-- Title -->
        <h1 class="text-center fs-1 me-3">MY COFFEE TRAY</h1>
        <!-- Sticker Image -->
        <div class="sticker">
            <img src="https://ih1.redbubble.net/image.2054677990.3953/bg,f8f8f8-flat,750x,075,f-pad,750x1000,f8f8f8.jpg" 
            alt="Coffee Sticker" 
            class="img-fluid rounded-circle shadow" style="width: 100px; height: 100px;">
        </div>
      </div>
    
      <div *ngIf="cartItems.length > 0; else emptyCart" class="mt-4">
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead>
              <tr>
                <th>Product Name</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Total</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cartItems">
                <td>{{ item.product_name }}</td>
                <td>Rs. {{ item.price }}</td>
                <td>
                  <div class="d-flex align-items-center">
                    <button (click)="updateQuantity(item.product_id, item.quantity - 1)" 
                            class="btn btn-sm btn-secondary me-2" 
                            [disabled]="item.quantity <= 1">-</button>
                    {{ item.quantity }}
                    <button (click)="updateQuantity(item.product_id, item.quantity + 1)" 
                            class="btn btn-sm btn-secondary ms-2">+</button>
                  </div>
                </td>
                <td>Rs. {{ item.price * item.quantity }}</td>
                <td>
                    
                  <button (click)="deleteItem(item.product_id)" class="btn btn-sm btn-danger">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
  
        <div class="text-end mt-4">
          <!-- Total Amount -->
          <h2 class="fw-bold text-warning-emphasis bg-warning-subtle p-3 rounded shadow-sm mb-3">
            Total Amount: Rs. {{ calculateTotal() }}
          </h2>
          <button (click)="clearCart()" class="btn btn-danger me-2 flex-grow-1">Clear Cart</button>
           <a href="/MenuComponent" class="btn btn-outline-primary flex-grow-1">Add more items</a>
           <button (click)="confirmOrder()" class="btn btn-outline-primary flex-grow-1">
  Check Out
</button>


        </div>
      </div>
  
     <ng-template #emptyCart>
  <p class="text-center text-muted">Your cart is empty.</p>

  <!-- Latest Order Tracker -->
  <div *ngIf="latestOrder" class="mt-4 p-4 bg-light rounded shadow-sm text-center">
    <h4 class="mb-3">ðŸ§¾ Latest Order Status Tracker</h4>

    <div class="d-flex justify-content-center align-items-center flex-wrap">
      <div *ngFor="let step of ['Paid', 'Processing', 'Complete', 'Delivered', 'Finished']; let i = index">
        <div
          [ngClass]="{
            'bg-success text-white': latestOrder.payment_status === step,
            'bg-secondary text-white': stepStatus(step),
            'bg-light text-dark': !stepStatus(step)
          }"
          class="px-3 py-2 rounded-pill mx-2 mb-2"
        >
          {{ step }}
        </div>
        <ng-container *ngIf="i < 4">
          <span class="mx-1 text-muted">â†’</span>
        </ng-container>
      </div>
    </div>
  </div>

  <!-- All Previous Orders -->
  <div *ngIf="allOrders.length > 0" class="mt-5">
    <h4 class="mb-3">ðŸ“¦ My All Orders</h4>

    <div *ngFor="let order of allOrders" class="mb-4 p-3 bg-white border rounded shadow-sm">
      <h5 class="mb-2">Order #{{ order.id }} | Rs. {{ order.total_amount }}</h5>
      <p>Status: <strong>{{ order.payment_status }}</strong></p>
      <p>Placed on: {{ order.created_at | date: 'short' }}</p>

     <div *ngIf="orderItemsMap && orderItemsMap[order.id] && orderItemsMap[order.id].length > 0" class="table-responsive">

        <table class="table table-sm table-bordered table-striped">
          <thead class="table-light">
            <tr>
              <th>Product Name</th>
              <th>Qty</th>
              <th>Price (Rs)</th>
              <th>Subtotal (Rs)</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of orderItemsMap[order.id]">
              <td>{{ item.name }}</td>
              <td>{{ item.quantity }}</td>
              <td>{{ item.price }}</td>
              <td>{{ item.price * item.quantity }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</ng-template>


    </div>
  </div>
  